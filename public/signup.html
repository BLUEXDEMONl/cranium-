<!-- cranium/public/signup.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Cranium - Sign up</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root {
      --bg: linear-gradient(-45deg,#0f0c29,#302b63,#24243e,#0f0c29);
      --glass: rgba(255,255,255,.08);
      --accent: #7c3aed;
    }
    *{box-sizing:border-box;font-family:"Inter",system-ui,sans-serif}
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--bg);
      background-size:400% 400%;
      animation:glow 15s ease infinite;
    }
    @keyframes glow{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .logo{
      display:block;
      margin:0 auto 1.5rem;
      width:100px;
      height:100px;
    }
    .card{
      width:90%;
      max-width:380px;
      padding:2.5rem 2rem;
      border-radius:20px;
      background:var(--glass);
      backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,.1);
      color:#fff;
      box-shadow:0 8px 32px rgba(0,0,0,.4);
      transition:transform .3s ease;
    }
    .card:hover{transform:translateY(-4px)}
    h1{text-align:center;margin-bottom:.5rem;font-weight:700;font-size:1.6rem}
    .subtitle{text-align:center;font-size:.85rem;opacity:.6;margin-bottom:2rem}
    label{display:block;margin:.75rem 0 .25rem;font-size:.85rem;opacity:.8}
    input{
      width:100%;
      padding:.8rem 1rem;
      border:none;
      border-radius:10px;
      background:rgba(255,255,255,.1);
      color:#fff;
      outline:none;
      transition:background .25s;
    }
    input:focus{background:rgba(255,255,255,.2)}
    .hint{font-size:.7rem;margin-top:.2rem;opacity:.7}
    .btn{
      width:100%;
      margin-top:1.8rem;
      padding:.9rem;
      border:none;
      border-radius:10px;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      cursor:pointer;
      transition:background .25s;
    }
    .btn:hover{background:#6d28d9}
    .btn:disabled{background:#4c1d95;cursor:wait}
    .error{
      margin-top:.75rem;
      font-size:.8rem;
      color:#fca5a5;
      text-align:center;
      animation:shake .4s;
    }
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      75%{transform:translateX(6px)}
    }
    .spinner{
      border:2px solid rgba(255,255,255,.2);
      border-top:2px solid #fff;
      border-radius:50%;
      width:16px;
      height:16px;
      animation:spin .5s linear infinite;
      display:inline-block;
      margin-right:.5rem;
      vertical-align:middle;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <form id="signupForm" class="card">
    <img src="./media/cranium.svg" alt="Cranium" class="logo" />

    <h1>Create account</h1>
    <p class="subtitle">Join the Cranium deployment platform</p>

    <label for="username">Username</label>
    <input id="username" type="text" minlength="3" required autocomplete="username"/>
    <span class="hint" id="userHint">At least 3 characters</span>

    <label for="gmail">Gmail</label>
    <input id="gmail" type="email" required autocomplete="email"/>
    <span class="hint" id="gmailHint"></span>

    <label for="password">Password</label>
    <div style="position:relative">
      <input id="password" type="password" minlength="6" required autocomplete="new-password"/>
      <button type="button" id="togglePw"
        style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:#fff;cursor:pointer;font-size:1.1rem">
        üëÅ
      </button>
    </div>
    <span class="hint" id="pwHint">At least 6 characters</span>

    <label for="confirm">Confirm Password</label>
    <input id="confirm" type="password" minlength="6" required autocomplete="new-password"/>
    <span class="hint" id="confirmHint">Re-type your password</span>

    <button class="btn" id="submitBtn" type="submit">
      <span id="btnText">Create account</span>
    </button>

    <div id="error" class="error d-none"></div>
    <p style="text-align:center;font-size:.8rem;margin-top:1rem">
      Already have an account? <a href="login.html" style="color:#c4b5fd">Log in</a>
    </p>
  </form>

<script>
const form   = document.getElementById('signupForm');
const user   = document.getElementById('username');
const gmail  = document.getElementById('gmail');
const pw     = document.getElementById('password');
const confirm= document.getElementById('confirm');
const userHint=document.getElementById('userHint');
const gmailHint=document.getElementById('gmailHint');
const pwHint=document.getElementById('pwHint');
const confirmHint=document.getElementById('confirmHint');
const submitBtn=document.getElementById('submitBtn');
const btnText=document.getElementById('btnText');
const error=document.getElementById('error');

// real-time validation
user.addEventListener('input', () => {
  userHint.textContent = user.value.length >= 3 ? '‚úì' : 'Need 3+ characters';
});
gmail.addEventListener('input', () => {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  gmailHint.textContent = re.test(gmail.value) ? '‚úì' : 'Valid Gmail address required';
});
pw.addEventListener('input', () => {
  pwHint.textContent = pw.value.length >= 6 ? '‚úì' : `${6 - pw.value.length} more chars`;
});
confirm.addEventListener('input', () => {
  confirmHint.textContent = confirm.value === pw.value ? '‚úì' : 'Passwords do not match';
});

// reveal/hide password
['togglePw','toggleConfirm'].forEach(id=>{
  document.getElementById(id)?.addEventListener('click',()=>{
    pw.type = pw.type === 'password' ? 'text' : 'password';
    confirm.type = confirm.type === 'password' ? 'text' : 'password';
  });
});

form.addEventListener('submit', async e => {
  e.preventDefault();
  if (pw.value !== confirm.value) {
    error.textContent = 'Passwords do not match';
    error.classList.remove('d-none');
    return;
  }
  error.classList.add('d-none');
  submitBtn.disabled = true;
  btnText.innerHTML = '<span class="spinner"></span>Creating‚Ä¶';

  const payload = {
    username: user.value.trim(),
    gmail:    gmail.value.trim(),
    password: pw.value.trim()
  };
  try {
    const res = await fetch('/api/signup', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Signup failed');
    localStorage.setItem('token', data.token);
    location.href = 'dashboard.html';
  } catch (err) {
    error.textContent = err.message;
    error.classList.remove('d-none');
    submitBtn.disabled = false;
    btnText.textContent = 'Create account';
  }
});
</script>
</body>
</html>
